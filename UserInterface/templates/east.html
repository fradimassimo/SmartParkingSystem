<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parking Space - East</title>
    <!-- Inclusione di Bootstrap 5 per lo stile moderno -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEJ4QJQG4KnFf9qfu2RkUq98lr6m1Xhw5vqfJ9yIj7wpzSe2A1hpXlNw43Rks" crossorigin="anonymous">
    <!-- Inclusione di Chart.js per il grafico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            color: #333;
        }

        .container-fluid {
            padding: 0;
        }

        /* Contenitore principale diviso in due colonne */
        .main-container {
            display: flex;
            height: 100vh;
            justify-content: space-between;
            padding: 30px;
        }

        .chart-container {
            flex: 1;
            padding-right: 30px;
        }

        .table-container {
            flex: 1;
            padding-left: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            font-size: 2.5rem;
            color: #2C3E50;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: center;
            cursor: pointer; /* Aggiungi il cursore per il clic */
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }

        td {
            background-color: #ecf0f1;
            border: 1px solid #ddd;
        }

        /* Effetto hover per le righe della tabella con colore più scuro per il testo */
        tr:hover {
            background-color: yellow; /* Colore di evidenza quando il mouse è sopra */
            color: red; /* Colore del testo durante l'hover */
        }

        /* Descrizione sotto "Dettaglio Parcheggio" */
        .description {
            margin-top: 20px;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        /* Gradient footer */
        footer {
            text-align: center;
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            padding: 10px 0;
            position: fixed;
            width: 100%;
            bottom: 0;
        }

        footer a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        footer a:hover {
            text-decoration: underline;
        }

    </style>
</head>
<body>

    <h1>Parking Space - East</h1>

    <div class="main-container">
        <!-- Colonna sinistra con l'istogramma -->
        <div class="chart-container">
            <canvas id="parkingAffluenceChart" width="400" height="400"></canvas>
        </div>

        <!-- Colonna destra con la tabella -->
        <div class="table-container">
            <h2 class="mb-4">Parking Space - Details</h2>
            <p class="description">Select the zone to check the car affluence over the day</p> <!-- Descrizione aggiunta -->
            <table id="parkingTable">
                <thead>
                    <tr>
                        <th>Covered Parking Zone</th>
                        <th>Occupied slots</th>
                        <th>Free slots</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-zone="Zona 1">
                        <td>Zona 1</td>
                        <td>10</td>
                        <td>15</td>
                    </tr>
                    <tr data-zone="Zona 2">
                        <td>Zona 2</td>
                        <td>8</td>
                        <td>20</td>
                    </tr>
                    <tr data-zone="Zona 3">
                        <td>Zona 3</td>
                        <td>12</td>
                        <td>10</td>
                    </tr>
                    <tr data-zone="Zona 4">
                        <td>Zona 4</td>
                        <td>5</td>
                        <td>25</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        <a href="{{ url_for('index') }}">Back to the home page</a>
    </footer>

    <!-- Script per creare l'istogramma con Chart.js -->
    <script>
        var ctx = document.getElementById('parkingAffluenceChart').getContext('2d');

        // Dati fittizi per ciascuna zona
        var parkingData = {
            'Zona 1': [10, 20, 30, 25, 15, 10, 20, 25, 30, 20, 15, 10, 20, 25, 30, 25, 15, 20, 25, 30, 35, 40, 45, 50],
            'Zona 2': [12, 22, 32, 28, 18, 12, 22, 28, 32, 22, 18, 12, 22, 28, 32, 28, 18, 22, 28, 32, 38, 42, 47, 52],
            'Zona 3': [15, 25, 35, 30, 20, 15, 25, 30, 35, 25, 20, 15, 25, 30, 35, 30, 20, 25, 30, 35, 40, 45, 50, 55],
            'Zona 4': [8, 18, 28, 24, 14, 8, 18, 24, 28, 18, 14, 8, 18, 24, 28, 24, 14, 18, 24, 28, 34, 38, 43, 48]
        };

        // Funzione per calcolare la media
        function calculateAverage(data) {
            var sum = data.reduce((a, b) => a + b, 0);
            return sum / data.length;
        }

        // Funzione per aggiornare il grafico in base alla zona
        function updateChart(zone) {
            var chartData = parkingData[zone] || [];
            var average = calculateAverage(chartData);

            parkingAffluenceChart.data.datasets[0].data = chartData;
            parkingAffluenceChart.data.datasets[1].data = Array(chartData.length).fill(average); // Dati della media
            parkingAffluenceChart.update();
        }

        // Creazione iniziale del grafico con Zona 1
        var parkingAffluenceChart = new Chart(ctx, {
            type: 'bar',  // Tipo di grafico a barre
            data: {
                labels: [
                    '00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', 
                    '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00',
                    '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00'
                ], // Etichette ore
                datasets: [{
                    label: 'Parking turnout (number of cars)',
                    data: parkingData['Zona 1'], // Dati iniziali per Zona 1
                    backgroundColor: 'rgba(54, 162, 235, 0.7)', // Colore delle barre
                    borderColor: 'rgba(54, 162, 235, 0.7)', // Colore del bordo delle barre
                    borderWidth: 1, // Larghezza del bordo
                    categoryPercentage: 1.0, // Rimuove gli spazi tra le categorie
                    barPercentage: 1.0, // Rimuove lo spazio tra le barre
                    barThickness: 30, // Larghezza delle barre
                    borderRadius: 0, // Rimuove il bordo arrotondato
                }, {
                    label: 'Average attendance',
                    data: Array(24).fill(calculateAverage(parkingData['Zona 1'])), // Linea media
                    type: 'line', // Tipo linea
                    borderColor: 'rgba(255, 99, 132, 1)', // Colore della linea
                    borderWidth: 2, // Larghezza della linea
                    fill: false, // Non riempire sotto la linea
                    tension: 0.1, // Morbidezza della linea
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#333',
                        }
                    },
                    title: {
                        display: true,
                        text: 'Hourly car park attendance - East', // Titolo
                        color: '#333',
                        font: {
                            size: 18,
                            weight: 'bold'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false, // Disabilita la griglia sull'asse X
                        },
                        ticks: {
                            color: '#333',
                            font: {
                                weight: 'bold',
                            },
                            maxRotation: 90,  // Ruota le etichette per l'asse X (ore)
                            minRotation: 45,
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#333',
                            font: {
                                weight: 'bold',
                            }
                        }
                    }
                }
            }
        });

        // Aggiungi il listener per le righe della tabella
        document.querySelectorAll('#parkingTable tbody tr').forEach(row => {
            row.addEventListener('click', function() {
                var selectedZone = row.getAttribute('data-zone');
                updateChart(selectedZone); // Aggiorna il grafico con i dati della zona selezionata
            });
        });
    </script>

    <!-- Inclusione di Bootstrap 5 JS (per funzionalità interattive) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

</body>
</html>
